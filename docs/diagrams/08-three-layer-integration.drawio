<mxfile host="app.diagrams.net" agent="Claude" version="24.0.0" type="device">
  <diagram id="integration" name="Hook-Based Integration">
    <mxGraphModel dx="1422" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="i_title" value="&lt;b&gt;Hook-Based LLM Integration&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:10px&quot;&gt;How Mnemon integrates with Claude Code via lifecycle hooks&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;fontSize=16;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="250" y="10" width="500" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i_session" value="&lt;b&gt;Session starts&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="380" y="60" width="240" height="35" as="geometry" />
        </mxCell>
        <mxCell id="i_hook_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="120" width="1020" height="200" as="geometry" />
        </mxCell>
        <mxCell id="i_hook_title" value="&lt;b&gt;Hooks&lt;/b&gt; — Claude Code lifecycle events → .claude/hooks/mnemon/" style="text;html=1;align=left;fontSize=12;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="60" y="125" width="500" height="25" as="geometry" />
        </mxCell>
        <mxCell id="i_h_prime" value="&lt;b&gt;Prime (SessionStart)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;prime.sh&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Load guide.md&lt;br&gt;(memory execution manual)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6F3FF;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="60" y="160" width="160" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_h1" value="&lt;b&gt;Remind (UserPromptSubmit)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;user_prompt.sh&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Remind agent to&lt;br&gt;recall &amp;amp; remember&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6F3FF;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="230" y="160" width="180" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_h_stop" value="&lt;b&gt;Nudge (Stop)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;stop.sh&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Remind agent to remember&lt;br&gt;(silent if already handled)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6F3FF;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="420" y="160" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_h_compact" value="&lt;b&gt;Compact (PreCompact)&lt;/b&gt; (optional)&lt;br&gt;&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;compact.sh&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Write flag file for&lt;br&gt;post-compact recall bridge&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6F3FF;strokeColor=#6c8ebf;fontSize=10;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="160" width="175" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_h_recall" value="&lt;b&gt;Recall (PreToolUse)&lt;/b&gt; (optional)&lt;br&gt;&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;task_recall.sh&lt;/font&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Remind agent to recall&lt;br&gt;before delegation&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6F3FF;strokeColor=#6c8ebf;fontSize=10;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="785" y="160" width="175" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_h_note" value="&lt;font style=&quot;font-size:9px;font-style:italic;color:#666&quot;&gt;Most hooks output &lt;b&gt;prompt-style text&lt;/b&gt; injected into LLM context — suggestions and context, not forced execution. Compact writes a flag file read by Prime.&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#ccc;fontSize=9;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="60" y="250" width="960" height="25" as="geometry" />
        </mxCell>
        <mxCell id="i_h_out1" value="&lt;font style=&quot;font-family:monospace;font-size:8px;color:#555&quot;&gt;→ [mnemon] Memory active + guide.md&lt;/font&gt;" style="text;html=1;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="60" y="278" width="160" height="18" as="geometry" />
        </mxCell>
        <mxCell id="i_h_out2" value="&lt;font style=&quot;font-family:monospace;font-size:8px;color:#555&quot;&gt;→ [mnemon] Evaluate: recall needed?&lt;/font&gt;" style="text;html=1;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="230" y="278" width="180" height="18" as="geometry" />
        </mxCell>
        <mxCell id="i_h_out3" value="&lt;font style=&quot;font-family:monospace;font-size:8px;color:#555&quot;&gt;→ [mnemon] Consider: ...remember?&lt;/font&gt;" style="text;html=1;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="420" y="278" width="170" height="18" as="geometry" />
        </mxCell>
        <mxCell id="i_h_out4" value="&lt;font style=&quot;font-family:monospace;font-size:8px;color:#555&quot;&gt;→ (silent: writes flag file)&lt;/font&gt;" style="text;html=1;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="600" y="278" width="175" height="18" as="geometry" />
        </mxCell>
        <mxCell id="i_h_out5" value="&lt;font style=&quot;font-family:monospace;font-size:8px;color:#555&quot;&gt;→ [mnemon] Before delegating: recall&lt;/font&gt;" style="text;html=1;align=center;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="785" y="278" width="175" height="18" as="geometry" />
        </mxCell>
        <mxCell id="i_eu" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="i_session" target="i_hook_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i_guide_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="1020" height="160" as="geometry" />
        </mxCell>
        <mxCell id="i_guide_title" value="&lt;b&gt;Guide&lt;/b&gt; — ~/.mnemon/prompt/guide.md (loaded by Prime at SessionStart)" style="text;html=1;align=left;fontSize=12;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="60" y="365" width="500" height="25" as="geometry" />
        </mxCell>
        <mxCell id="i_c1" value="&lt;b&gt;Recall Rules&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Default: recall every message&lt;br&gt;Skip only if: direct follow-up&lt;br&gt;within current context&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6FFE6;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="60" y="400" width="200" height="75" as="geometry" />
        </mxCell>
        <mxCell id="i_c2" value="&lt;b&gt;Remember Decision Tree&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Step 1: directive/reasoning/state?&lt;br&gt;Step 2: overlap check (update/replace/create)&lt;br&gt;Step 3: cost-benefit evaluation&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6FFE6;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="290" y="400" width="260" height="75" as="geometry" />
        </mxCell>
        <mxCell id="i_c3" value="&lt;b&gt;Sub-Agent Delegation&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Delegate to Task sub-agent&lt;br&gt;(Bash type, Sonnet model)&lt;br&gt;Only provide WHAT to store&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6FFE6;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="580" y="400" width="210" height="75" as="geometry" />
        </mxCell>
        <mxCell id="i_c4" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;Do NOT remember:&lt;/b&gt;&lt;br&gt;operational tasks,&lt;br&gt;public mnemon,&lt;br&gt;info in git&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="820" y="400" width="140" height="75" as="geometry" />
        </mxCell>
        <mxCell id="i_ec" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#82b366;strokeWidth=2;" edge="1" parent="1" source="i_hook_box" target="i_guide_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i_skill_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="40" y="560" width="1020" height="140" as="geometry" />
        </mxCell>
        <mxCell id="i_skill_title" value="&lt;b&gt;Skill&lt;/b&gt; — .claude/skills/mnemon/SKILL.md (auto-discovered by Claude Code)" style="text;html=1;align=left;fontSize=12;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="60" y="565" width="500" height="25" as="geometry" />
        </mxCell>
        <mxCell id="i_s1" value="&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;mnemon remember &quot;fact&quot;&lt;br&gt;  --cat decision --imp 5&lt;br&gt;  --entities &quot;A,B&quot;&lt;br&gt;  (diff built-in)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=9;align=left;spacingLeft=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="600" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_s2" value="&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;mnemon recall &quot;topic&quot;&lt;br&gt;  --limit 10&lt;br&gt;mnemon search &quot;keyword&quot;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=9;align=left;spacingLeft=8;" vertex="1" parent="1">
          <mxGeometry x="300" y="600" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_s3" value="&lt;font style=&quot;font-family:monospace;font-size:9px&quot;&gt;mnemon link &amp;lt;src&amp;gt; &amp;lt;tgt&amp;gt;&lt;br&gt;  --type causal&lt;br&gt;mnemon forget &amp;lt;id&amp;gt;&lt;br&gt;mnemon gc --keep &amp;lt;id&amp;gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#d6b656;fontSize=9;align=left;spacingLeft=8;" vertex="1" parent="1">
          <mxGeometry x="540" y="600" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_s4" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;Separation of concerns:&lt;/b&gt;&lt;br&gt;Hooks = prime / remind / nudge / compact / recall&lt;br&gt;Guide = when &amp;amp; what (execution manual)&lt;br&gt;Skill = how (command reference)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="780" y="600" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_es" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#d6b656;strokeWidth=2;" edge="1" parent="1" source="i_guide_box" target="i_skill_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i_response" value="&lt;b&gt;LLM generates memory-aware response&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Nudge fires → remind agent to remember&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="250" y="740" width="500" height="50" as="geometry" />
        </mxCell>
        <mxCell id="i_er" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="i_skill_box" target="i_response">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i_subagent_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9673a6;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="130" y="820" width="800" height="120" as="geometry" />
        </mxCell>
        <mxCell id="i_subagent_title" value="&lt;b&gt;Sub-Agent Delegation&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;Memory writes isolated from main conversation&lt;/font&gt;" style="text;html=1;align=left;fontSize=11;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="150" y="828" width="350" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i_sa_main" value="&lt;b&gt;Main Agent (Opus)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;~25k tokens context&lt;br&gt;Decides WHAT to remember&lt;br&gt;Provides: content, category,&lt;br&gt;importance, entities&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="160" y="860" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_sa_sub" value="&lt;b&gt;Sub-Agent (Sonnet)&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size:9px&quot;&gt;~1k tokens context&lt;br&gt;Reads SKILL.md&lt;br&gt;Executes mnemon remember&lt;br&gt;Evaluates link candidates&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F3E5F5;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="470" y="860" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_sa_why" value="&lt;font style=&quot;font-size:9px&quot;&gt;&lt;b&gt;Why?&lt;/b&gt;&lt;br&gt;Token economy: ~7k vs ~25k&lt;br&gt;Context isolation&lt;br&gt;Model efficiency&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#999;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="730" y="860" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i_sa_edge" value="&lt;font style=&quot;font-size:9px&quot;&gt;delegates&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#9673a6;strokeWidth=1;html=1;fontSize=9;" edge="1" parent="1" source="i_sa_main" target="i_sa_sub">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i_e_resp_sa" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#9673a6;strokeWidth=2;" edge="1" parent="1" source="i_response" target="i_subagent_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i_feedback" value="&lt;font style=&quot;font-size:9px&quot;&gt;mnemon remember (diff built-in)&lt;br&gt;writes to ~/.mnemon&lt;/font&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#82b366;strokeWidth=1;dashed=1;html=1;fontSize=9;" edge="1" parent="1" source="i_subagent_box" target="i_hook_box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="530" y="970" />
              <mxPoint x="30" y="970" />
              <mxPoint x="30" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i_setup" value="&lt;b&gt;mnemon setup&lt;/b&gt; deploys all components automatically. &lt;b&gt;mnemon setup --eject&lt;/b&gt; removes them." style="text;html=1;align=center;fontSize=10;fillColor=none;strokeColor=none;fontColor=#666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="200" y="1000" width="600" height="20" as="geometry" />
        </mxCell>
        <mxCell id="i_adapt" value="&lt;b&gt;Other LLM CLIs:&lt;/b&gt; Replicate hook pattern, or merge guide + skill into .cursorrules / RULES.md / system prompt" style="text;html=1;align=center;fontSize=10;fillColor=none;strokeColor=none;fontColor=#666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="200" y="1020" width="600" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
